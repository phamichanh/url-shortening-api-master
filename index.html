<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/index-styles.css" >
  <title>Frontend Mentor | Shortly URL shortening API Challenge</title>

</head>
<body>
  <header>
    <article class="main-view">
      <img id="logo-header" alt="Shortly logo" src="images/logo.svg" />

      <nav id="nav-header">
        <ul>
          <li><a>Features</a></li>
          <li><a>Pricing</a></li>
          <li><a>Resources</a></li>
        </ul>
      </nav>

      <article id="account">
        <a class="btn-login">Login</a>
        <a class="btn-main-style btn-sign-up">Sign Up</a>
      </article>
    </article>
  </header>

  <section id="link-shorten-section">
    <article id="intro-content" class="main-view">
      <div class="intro-features-content">
        <h1>More than just shorter links</h1>
        <p>Build your brand’s recognition and get detailed insights on how your links are performing.</p>
        <a class="btn-main-style btn-get-start">Get Started</a>
      </div>

      <div id="shortly-link-form" >
        <input type="text" id="inputLink" class="normal-input" placeholder="Shorten a link here..." title="Shorten Link">
        <button title="Submit Link Button" class="btn-main-style" onclick="shortenLink();">Shorten It!</button>
        <p id="input-error-message"></p>
      </div>
    </article>

  </section>

  <section id="intro-service-section">
    <article id="results-list-box" class="main-view">
      <ul id="shorten-links-list"></ul>
      <template id="result-template">
        <div class="result-box">
          <p class="original-link">https://original.link.com</p>
          <div class="copy-result-box">
            <p class="shorten-link">https://shorten.link.com</p>
            <a class="btn-main-style btn-copy">Copy</a>
          </div>
        </div>
      </template>
    </article>

    <article class="service-introduce-content main-view">
      <h2>Advanced Statistics</h2>
      <p>Track how your links are performing across the web with our advanced statistics dashboard.</p>
    </article>

    <article class="service-list-box main-view">
      <article class="service-detail" id="brand-recognition">
        <div class="service-icon"></div>
        <h3>Brand Recognition</h3>
        <p>Boost your brand recognition with each click. Generic links don’t mean a thing. Branded links help instil confidence in your content.</p>
      </article>

      <div class="margin-line"></div>

      <article class="service-detail" id="detailed-records">
        <div class="service-icon"></div>
        <h3>Detailed Records</h3>
        <p>Gain insights into who is clicking your links. Knowing when and where people engage with your content helps inform better decisions.</p>
      </article>

      <div class="margin-line"></div>

      <article class="service-detail" id="fully-customizable">
        <div class="service-icon"></div>
        <h3>Fully Customizable</h3>
        <p>Improve brand awareness and content discoverability through customizable links, supercharging audience engagement.</p>
      </article>
    </article>

  </section>

  <section id="boost-section">
    <article class="boost-box main-view">
      <h2>Boost your links today</h2>
      <a class="btn-main-style btn-get-start">Get Started</a>
    </article>
  </section>


  <footer>
    <article class="main-view">
      <img id="logo-footer" alt="Shortly logo" src="images/logo-footer.svg" />
      <nav class="nav-footer">
        <h4>Features</h4>
        <ul>
          <li><a>Link Shortening</a></li>
          <li><a>Branded Links</a></li>
          <li><a>Analytics</a></li>
        </ul>
      </nav>

      <nav class="nav-footer">
        <h4>Resources</h4>
        <ul>
          <li><a>Blog</a></li>
          <li><a>Developers</a></li>
          <li><a>Support</a></li>
        </ul>
      </nav>

      <nav class="nav-footer">
        <h4>Company</h4>
        <ul>
          <li><a>About</a></li>
          <li><a>Our Team</a></li>
          <li><a>Careers</a></li>
          <li><a>Contact</a></li>
        </ul>
      </nav>

      <nav class="share-nav">
        <ul>
          <li><a id="share-facebook"></a></li>
          <li><a id="share-twitter"></a></li>
          <li><a id="share-pinterest"></a></li>
          <li><a id="share-instagram"></a></li>
        </ul>
      </nav>
    </article>

    <div class="attribution">
      Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>.
      Coded by <a href="#">Pham Ich Anh</a>.
    </div>
  </footer>

  <script>

  function shortenLink() {
    var xhr = new XMLHttpRequest();
    var apiUrl = "https://rel.ink/api/links/";
    xhr.open("POST", apiUrl, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 201) {
          var json = JSON.parse(xhr.responseText);
          addResult(json.url, "https://rel.ink/" + json.hashid);
        }
    };

    var originalLink = document.getElementById("inputLink");
    var error = checkInputLink(originalLink.value);
    if(error === 0) {
      showError("", false);
      var data = JSON.stringify({"url": originalLink.value});
      xhr.send(data);
      originalLink.value = "";
    } else {
      showError(error, true);
    }
  }

  function addResult(originalLink, shortenLink) {
    var resultsList = document.getElementById("shorten-links-list");
    var numOfList = resultsList.getElementsByTagName("li").length + 1;
    var shortenLinkID = "shortenLink-" + numOfList;
    var copyBtnID = "copyBtn-" + numOfList;

    var newItem = document.createElement("LI");
    var content = document.getElementById('result-template').content;
    var originalLinkText = content.querySelector('.original-link');
    var shortenLinkText = content.querySelector('.shorten-link');
    var copyButton = content.querySelector('.btn-copy');

    originalLinkText.textContent = originalLink;
    shortenLinkText.textContent = shortenLink;
    shortenLinkText.setAttribute("id", shortenLinkID);
    copyButton.setAttribute("id", copyBtnID);
    copyButton.setAttribute("onclick", "copyShortenLink('" + numOfList + "')\;");

    newItem.appendChild(document.importNode(content, true));

    resultsList.insertBefore(newItem, resultsList.childNodes[0]);
  }

  function showError(errorMessage, isError) {
    document.getElementById('input-error-message').textContent = errorMessage;
    var inputTextbox = document.getElementById("inputLink");
    if(isError) {
      inputTextbox.classList.remove("normal-input");
      inputTextbox.classList.add("error-input");
    } else {
      inputTextbox.classList.remove("error-input");
      inputTextbox.classList.add("normal-input");
    }
    inputTextbox.focus();
  }

  function checkInputLink(originalLink) {
    if(originalLink == "") {
      return "Please add a link";
    } else if (!validateUlr(originalLink)) {
      return "Invalid URL, please use this format: \"https://www.example.com\"";
    }
    return 0;
  }

  function validateUlr(url) {
    const regex = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;
    const result = url.match(regex);
    if (result) {
      return true;
    }
    return false;
  }

  function copyShortenLink(copyID) {
    var shortenLinkID = "shortenLink-" + copyID;
    var copyBtnID = "copyBtn-" + copyID;

    var text = document.getElementById(shortenLinkID).innerText;
    var elem = document.createElement("textarea");
    document.body.appendChild(elem);
    elem.value = text;
    elem.select();
    elem.setSelectionRange(0, 99999);
    document.execCommand("copy");
    document.body.removeChild(elem);

    resetCopyButton(copyBtnID);
  }

  function resetCopyButton(clickedBtnID) {
    var i;
    var listButtons = document.getElementsByClassName("btn-copy");
    for (i = 0; i < listButtons.length; i++) {
       listButtons[i].textContent = "Copy";
       listButtons[i].classList.remove("copied");
    }

    var clickedBtn = document.getElementById(clickedBtnID);
    clickedBtn.textContent = "Copied!";
    clickedBtn.classList.add("copied");
  }

  </script>
</body>
</html>
